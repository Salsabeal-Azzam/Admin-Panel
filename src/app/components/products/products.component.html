<div class="products">
  <h2 class="title">Products</h2>
  @if(isLoading){
  <app-spinner />
  } @else {
  <div>
    <p-table
      [value]="products"
      [paginator]="true"
      [breakpoint]="'768px'"
      [rows]="10"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Name</th>
          <th>Image</th>
          <th>Price</th>
          <th>Category</th>
          <th>Reviews</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
        <tr>
          <td>{{ product?.title }}</td>
          <td>
            <p-image
              [src]="product?.image"
              [previewImageSrc]="product?.image"
              [alt]="product?.title"
              width="50"
              height="50"
              [preview]="true"
            />
          </td>
          <td>{{ product?.price | currency }}</td>
          <td>{{ product?.category }}</td>
          <td>
            <p-rating
              [(ngModel)]="product?.rating.rate"
              readonly="true"
              [cancel]="false"
            />
          </td>
          <td>
            <div class="products__btn-actions">
              <button
                pButton
                type="button"
                icon="pi pi-eye"
                (click)="viewProductDetails(product)"
                [rounded]="true"
                [text]="true"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-pencil"
                (click)="showUpdateProductModal(product)"
                [rounded]="true"
                [text]="true"
                severity="warning"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-trash"
                (click)="deleteProduct(product.id)"
                [rounded]="true"
                [text]="true"
                severity="danger"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <div class="products__submit-btn">
      <button
        pButton
        type="button"
        label="Add Product"
        icon="pi pi-plus"
        (click)="showAddProductModal()"
        severity="info"
      ></button>
    </div>
  </div>
  }
  <p-dialog
    header="Product Details"
    [(visible)]="showProductDetails"
    modal="true"
    [closable]="true"
  >
    @if (selectedProduct) {
    <div>
      <h3>{{ selectedProduct.title }}</h3>
      <img
        [src]="selectedProduct.image"
        alt="{{ selectedProduct.title }}"
        width="200"
      />
      <p><strong>Description:</strong> {{ selectedProduct.description }}</p>
      <p><strong>Price:</strong> {{ selectedProduct.price | currency }}</p>
      <p><strong>Category:</strong> {{ selectedProduct.category }}</p>
    </div>
    }
  </p-dialog>
  <div>
    <p-dialog
      header="{{ isUpdateMode ? 'Update Product' : 'Add Product' }}"
      [(visible)]="displayModal"
      modal="true"
      [closable]="true"
    >
      <form [formGroup]="addOrUpdateProductForm" (ngSubmit)="onSubmit()">
        <div class="p-fluid">
          <div class="p-field">
            <label for="title">Product Title</label>
            <input
              id="title"
              formControlName="title"
              pInputText
              class="form-control"
            />
          </div>

          <div class="p-field">
            <label for="price">Price</label>
            <input
              id="price"
              formControlName="price"
              pInputText
              type="number"
              class="form-control"
            />
          </div>

          <div class="p-field">
            <label for="description">Description</label>
            <textarea
              id="description"
              formControlName="description"
              pInputTextarea
              rows="3"
              class="form-control"
            ></textarea>
          </div>

          <div class="p-field">
            <label for="image">Image URL</label>
            <input
              id="image"
              formControlName="image"
              pInputText
              class="form-control"
            />
          </div>

          <div class="p-field">
            <label for="category">Category</label>
            <input
              id="category"
              formControlName="category"
              pInputText
              class="form-control"
            />
          </div>

          <button
            type="submit"
            pButton
            label="{{ isUpdateMode ? 'Update Product' : 'Add Product' }}"
            class="btn btn-primary mt-3"
          ></button>
        </div>
      </form>
    </p-dialog>
  </div>
</div>
